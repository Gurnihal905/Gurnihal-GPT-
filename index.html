<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GURNIHAL GPT</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
html,body{height:100%;margin:0;overflow:hidden}
#app{height:100vh;display:flex}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-thumb{background:#888;border-radius:10px}
</style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

<div id="app">

<!-- SIDEBAR -->
<div class="w-72 bg-white dark:bg-gray-800 border-r flex flex-col">
<div class="p-4 border-b">
<h1 class="font-bold text-xl">ðŸ¤– GURNIHAL GPT</h1>
<p class="text-xs text-gray-500">Created by SIDAKGPT</p>
</div>

<button onclick="newChat()" class="m-4 p-3 bg-blue-600 text-white rounded-lg">
+ New Chat
</button>

<div id="history" class="flex-1 overflow-y-auto"></div>
</div>

<!-- MAIN -->
<div class="flex-1 flex flex-col">

<header class="p-4 border-b flex justify-between">
<h2 class="font-semibold">AI Chat</h2>
<button onclick="toggleTheme()">ðŸŒ™</button>
</header>

<div id="chat" class="flex-1 overflow-y-auto p-6 space-y-4"></div>

<div class="p-4 border-t">
<textarea id="input" rows="1" placeholder="Type message..."
class="w-full border p-3 rounded-lg resize-none"></textarea>
<button onclick="send()" class="mt-2 px-5 py-2 bg-blue-600 text-white rounded">
Send
</button>
</div>

</div>
</div>

<script>

let API_KEY = localStorage.getItem("api") || prompt("Enter OpenRouter API Key");

localStorage.setItem("api", API_KEY);

let chats = JSON.parse(localStorage.getItem("chats") || "[]");
let current = null;

function save(){
localStorage.setItem("chats", JSON.stringify(chats));
}

function newChat(){
const id=Date.now();
chats.unshift({id,title:"New Chat",messages:[]});
current=id;
save();
renderHistory();
renderChat();
}

function renderHistory(){
const h=document.getElementById("history");
h.innerHTML="";
chats.forEach(c=>{
const div=document.createElement("div");
div.className="p-3 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700";
div.innerText=c.title;
div.onclick=()=>{current=c.id;renderChat()};
h.appendChild(div);
});
}

function renderChat(){
const chat=document.getElementById("chat");
chat.innerHTML="";
const c=chats.find(x=>x.id===current);
if(!c)return;

c.messages.forEach(m=>{
addMsg(m.role,m.content,false);
});
}

function addMsg(role,text,saveMsg=true){
const div=document.createElement("div");
div.className="max-w-xl p-4 rounded-lg "+(role=="user"?"bg-blue-600 text-white ml-auto":"bg-gray-200 dark:bg-gray-700");
div.innerHTML=role=="user"?text:marked.parse(text);
chat.appendChild(div);
chat.scrollTop=chat.scrollHeight;

if(saveMsg){
const c=chats.find(x=>x.id===current);
c.messages.push({role,content:text});
save();
}
}

async function send(){
if(!current)newChat();
const input=document.getElementById("input");
const text=input.value.trim();
if(!text)return;

addMsg("user",text);
input.value="";

const aiDiv=document.createElement("div");
aiDiv.className="bg-gray-200 dark:bg-gray-700 p-4 rounded-lg max-w-xl";
chat.appendChild(aiDiv);

let full="";

const res=await fetch("https://openrouter.ai/api/v1/chat/completions",{
method:"POST",
headers:{
Authorization:"Bearer "+API_KEY,
"Content-Type":"application/json"
},
body:JSON.stringify({
model:"deepseek/deepseek-r1:free",
messages:[{role:"user",content:text}],
stream:true
})
});

const reader=res.body.getReader();
const decoder=new TextDecoder();

while(true){
const {done,value}=await reader.read();
if(done)break;

const chunk=decoder.decode(value);
chunk.split("\n").forEach(line=>{
if(!line.startsWith("data:"))return;
const data=line.replace("data:","").trim();
if(!data||data=="[DONE]")return;

const json=JSON.parse(data);
const content=json.choices?.[0]?.delta?.content||"";
full+=content;
aiDiv.innerHTML=marked.parse(full);
});
}

addMsg("assistant",full,true);
}

document.getElementById("input").onkeydown=e=>{
if(e.key==="Enter"&&!e.shiftKey){
e.preventDefault();
send();
}
};

function toggleTheme(){
document.documentElement.classList.toggle("dark");
}

renderHistory();

</script>
</body>
    </html>
